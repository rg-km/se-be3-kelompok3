const ORIENTATION_VERTICAL="ORIENTATION_VERTICAL",ORIENTATION_HORIZONTAL="ORIENTATION_HORIZONTAL",DIRECTION_LEFT=0,DIRECTION_UP=1,DIRECTION_RIGHT=2,DIRECTION_DOWN=3;class SnakeAPI{constructor(t){this.ctx=t.getContext("2d"),this.canvasWidth=t.width,this.canvasHeigth=t.height,this.speedRunner=100,this.snake=[]}startRunner=t=>{this.intervalDraw=setInterval((()=>{this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeigth),t()}),this.speedRunner)};initSpeed=(t=100)=>{this.speedRunner-=t};getRandomPosition=()=>({posX:Math.floor(Math.random()*((this.canvasWidth-CELL_SIZE)/CELL_SIZE))*CELL_SIZE,posY:Math.floor(Math.random()*((this.canvasHeigth-CELL_SIZE)/CELL_SIZE))*CELL_SIZE});stopRunner=()=>{clearInterval(this.intervalDraw)};getContext=()=>this.ctx;getSpeed=()=>this.speedRunner;clearBoard=()=>{this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeigth)};obstacle=(t,s,o=CELL_SIZE,e=ORIENTATION_HORIZONTAL,i="#808080",n=(()=>{}))=>{this.ctx.fillStyle=i;const{isHitObstacle:a,affectedSnake:c}=this.isHittedObstacle(t*CELL_SIZE,s*CELL_SIZE,o,e);if(a){const t=new Audio("assets/hit-wall.wav"),{posX:s,posY:o}=this.getRandomPosition();t.play(),n(c),c.hp--,c.posX=s,c.posY=o,c.direction=initDirection(),c.body=[{posX:s,posY:o}]}e===ORIENTATION_HORIZONTAL?this.ctx.fillRect(t*CELL_SIZE,s*CELL_SIZE,o*CELL_SIZE,CELL_SIZE):this.ctx.fillRect(t*CELL_SIZE,s*CELL_SIZE,CELL_SIZE,o*CELL_SIZE)};isHittedObstacle=(t,s,o,e)=>{let i,n=!1;if(e===ORIENTATION_VERTICAL)for(let e=0;e<this.snake?.length;e++){const a=this.snake[e];for(let e=0;e<o;e++)a.posX===t&&a.posY===s+e*CELL_SIZE&&(n=!0,i=a)}else if(e===ORIENTATION_HORIZONTAL)for(let e=0;e<this.snake?.length;e++){const a=this.snake[e];for(let e=0;e<o;e++)a.posX===t+e*CELL_SIZE&&a.posY===s&&(n=!0,i=a)}return{isHitObstacle:n,affectedSnake:i}};createObjectOnBoard=(t,s,o)=>{const{isHitted:e,affectedSnake:i}=this.isHittedCell(t);if(s?blinking((()=>{this.ctx.drawImage(t.image,t.posX,t.posY)})):this.ctx.drawImage(t.image,t.posX,t.posY),e){if(o)return void o(i,t);const s=new Audio("assets/get-point.wav");t.posX=this.getRandomPosition().posX,t.posY=this.getRandomPosition().posY,s.play(),i.score+=1,i.body.push({posX:i.posX,posY:i.posY})}};createMovingObstacle=(t,s=(()=>{}))=>{this.ctx.drawImage(t.image,t.posX,t.posY),this.movingObject(t),this.movingPortal(t);for(let o=0;o<this.snake?.length;o++){const e=this.snake[o];for(let o=0;o<e.body.length;o++){const i=e.body[o];if(i.posX===t.posX&&i.posY===t.posY){s(e,t);const{posX:o,posY:i}=this.getRandomPosition();e.hp--,e.body=[{posX:o,posY:i}],e.posX=o,e.posY=i,e.direction=initDirection()}}}};isHittedCell=t=>{let s,o=!1;for(let e=0;e<this.snake?.length;e++){const i=this.snake[e];i.posX===t.posX&&i.posY===t.posY&&(o=!0,s=i)}return{isHitted:o,affectedSnake:s}};createSnake=(t,s)=>{let o="orange";this.snake.map((t=>t.id)).includes(t.id)||this.snake.push(t),t.color&&(o=t.color),t.headImage?this.ctx.drawImage(t.headImage,t.posX,t.posY):(this.ctx.fillStyle=o,this.ctx.fillRect(t.posX,t.posY,CELL_SIZE,CELL_SIZE));for(let s=0;s<t.body.length;s++){const o=t.body[s];0!==s&&(t.bodyImage?this.ctx.drawImage(t.bodyImage,o.posX,o.posY):this.ctx.fillRect(o.posX,o.posY,CELL_SIZE,CELL_SIZE))}this.movingObject(t),t.body.unshift({posX:t.posX,posY:t.posY}),t.body.pop(),document.addEventListener("keydown",(s=>{"ArrowUp"===s.code&&3!==t.direction?t.direction=1:"ArrowRight"===s.code&&0!==t.direction?t.direction=2:"ArrowDown"===s.code&&1!==t.direction?t.direction=3:"ArrowLeft"===s.code&&2!==t.direction&&(t.direction=0)})),this.movingPortal(t)};movingObject=t=>{2===t.direction&&(t.posX+=20),3===t.direction&&(t.posY+=20),0===t.direction&&(t.posX-=20),1===t.direction&&(t.posY-=20)};movingPortal=t=>{t.posX>this.canvasWidth-CELL_SIZE?t.posX=-20:t.posX<0?t.posX=this.canvasWidth:t.posY>this.canvasHeigth-CELL_SIZE?t.posY=-20:t.posY<0&&(t.posY=this.canvasHeigth)}}let counter=0;function blinking(t=(()=>{})){counter++,counter%2==0&&t()}
